<html lang="en">

<head>
    <meta charset="utf-8">
    <title>hello-rust-from-js</title>
</head>

<body>
    <div id="loading_status_div">WebAssembly not loaded</div>
    <div id="output_div"></div>
    <div id="result_div"></div>
    <button id="main_button" disabled>click me</button>
    <script type="module">
        "use strict";
        document.getElementById("loading_status_div").innerText = "Attempting to import the WebAssembly package";
        import init, { interpret_in_web } from './pkg/pipes_rs.js';
        document.getElementById("loading_status_div").innerText = "WebAssembly package imported, not initialized";

        async function run() {
            function addListener(dom_id, event_type, callback) {
                document.getElementById(dom_id).addEventListener(event_type, callback);
            }
            addListener("main_button", "click", update_div);
            document.getElementById("loading_status_div").innerText = "Attempting to initialize the WebAssembly package";
            await init();
            document.getElementById("loading_status_div").innerText = "WebAssembly loaded";
            document.getElementById("main_button").removeAttribute("disabled");

            function update_div() {
                const result_obj = interpret_in_web("\"hello\" |print; 5");
                document.getElementById("output_div").innerText = result_obj[1]
                document.getElementById("result_div").innerText = "Result: " + result_obj[0];
            }
        }

        run();
    </script>
</body>

</html>
